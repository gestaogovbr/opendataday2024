(self.webpackChunkipyevents=self.webpackChunkipyevents||[]).push([[480],{235:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.EventModel=void 0;const r=s(829),a=s(657),_=n(s(794));let l=["altKey","ctrlKey","metaKey","shiftKey","type","timeStamp"],d=["clientX","clientY","pageX","pageY","screenX","screenY"],c=["dataX","dataY","relativeX","relativeY","boundingRectWidth","boundingRectHeight","boundingRectTop","boundingRectLeft","boundingRectBottom","boundingRectRight","arrayX","arrayY"],u=["button","buttons","layerX","layerY","movementX","movementY","offsetX","offsetY","x","y"],h=["deltaX","deltaY","deltaZ","deltaMode"],p=["changedTouches","targetTouches","touches"],v=["identifier"],m=["dataTransfer"],f=["code","key","location","repeat"],g=["tagName","id","className"],y={};class b extends r.WidgetModel{defaults(){return _.extend(super.defaults(),{_model_name:"EventModel",_model_module:"ipyevents",_model_module_version:a.EXTENSION_SPEC_VERSION,source:null,watched_events:[],ignore_modifier_key_events:!1,prevent_default_action:!1,xy_coordinate_system:null,xy:[],wait:0,throttle_or_debounce:null,_supported_mouse_events:[],_supported_key_events:[],_supported_touch_events:[],_modifier_keys:["Shift","Control","Alt","Meta"]})}initialize(e,t){super.initialize(e,t),this.on("change:source",this.prepare_source,this),this.on("change:watched_events",this.update_listeners,this),this.on("change:xy_coordinate_system",this.update_listeners,this),this.on("change:wait",this.update_listeners,this),this.on("change:throttle_or_debounce",this.update_listeners,this),this.prepare_source()}key_mouse_or_touch(e){return _.contains(this.get("_supported_mouse_events"),e)?"mouse":_.contains(this.get("_supported_key_events"),e)?"keyboard":_.contains(this.get("_supported_touch_events"),e)?"touch":void 0}_cache_listeners(e,t,s){y[this.model_id]||(y[this.model_id]=[]),y[this.model_id].push({event:e,view:t,func:s})}prepare_source(){let e=this.previous("source");this.stopListening(e);let t=this.get("source");"DOMWidgetModel"!=t.name&&("number"!=typeof t.get("_view_count")&&t.set("_view_count",0),this.listenTo(t,"change:_view_count",this.update_listeners),this.update_listeners())}update_listeners(){this.remove_listeners(),this.attach_listeners()}remove_listeners(){if(y[this.model_id])for(let e of y[this.model_id])e.view.el.removeEventListener(e.event,e.func);y[this.model_id]=null,this.get("xy").length>0&&(this.set("xy",[]),this.save_changes())}_add_listeners_to_view(e){for(let t of this.get("watched_events"))switch(this.key_mouse_or_touch(t)){case"keyboard":this._add_key_listener(t,e);break;case"touch":case"mouse":let s=this._throttle_or_debounce(this._dom_click.bind(this,e)),i=this._prevent_event_propagation.bind(this,e);e.el.addEventListener(t,s),e.el.addEventListener(t,i),this._cache_listeners(t,e,s),this._cache_listeners(t,e,i);break;default:console.error("Not familiar with that message source")}if(this.get("xy_coordinate_system")){let t=this._throttle_or_debounce(this._set_xy.bind(this,e)),s=this._prevent_event_propagation.bind(this,e),i="mousemove";e.el.addEventListener(i,t),e.el.addEventListener(i,s),this._cache_listeners(i,e,t),this._cache_listeners(i,e,s)}}attach_listeners(){let e=this.get("source");_.each(e.views,(e=>{Promise.resolve(e).then((e=>{this._add_listeners_to_view(e)}))}))}_add_key_listener(e,t){let s=e=>{this.get("ignore_modifier_key_events")&&_.contains(this.get("_modifier_keys"),e.key)||(this._send_dom_event(e),e.stopPropagation(),e.preventDefault())},i="ipyevents-watched",o="-4242";s=this._throttle_or_debounce(s);let n=()=>{document.addEventListener(e,s,!0),t.el.focus({preventScroll:!0}),t.el!=document.activeElement&&(t.el.setAttribute("tabindex",o),t.el.focus({preventScroll:!0})),t.el.classList.add(i)},r=()=>{document.removeEventListener(e,s,!0),t.el.getAttribute("tabindex")==o&&t.el.removeAttribute("tabindex"),t.el.classList.remove(i),t.el.blur()};t.el.addEventListener("mouseenter",n),t.el.addEventListener("mouseleave",r),this._cache_listeners("mouseenter",t,n),this._cache_listeners("mouseleave",t,r)}_supplement_mouse_or_touch_positions(e,t){if("touch"==this.key_mouse_or_touch(t.type))for(let s of p)for(let i of t[s])this._supplement_mouse_positions(e,i);else this._supplement_mouse_positions(e,t)}_supplement_mouse_positions(e,t){let s=function(e,t){var s=e.el.getBoundingClientRect(),i=s.top,o=s.left;return{x:Math.round(t.clientX-o),y:Math.round(t.clientY-i)}}(e,t);if(t.relativeX=s.x,t.relativeY=s.y,"_data_xy"in e){let s=e._data_xy(t);t.dataX=s.x,t.dataY=s.y}else if("ImageView"==e.model.get("_view_name")){let s=function(e,t){var s=parseInt(e.el.style.paddingLeft)||0,i=parseInt(e.el.style.borderLeft)||0,o=parseInt(e.el.style.paddingTop)||0,n=parseInt(e.el.style.borderTop)||0,r=parseInt(t.relativeX)-i-s,a=parseInt(t.relativeY)-n-o;return{x:Math.round(r/e.el.width*e.el.naturalWidth),y:Math.round(a/e.el.height*e.el.naturalHeight)}}(e,t);t.dataX=s.x,t.dataY=s.y}var i=e.el.getBoundingClientRect();t.boundingRectWidth=i.width,t.boundingRectHeight=i.height,t.boundingRectTop=i.top,t.boundingRectLeft=i.left,t.boundingRectBottom=i.bottom,t.boundingRectRight=i.right,"dataX"in t&&(t.arrayX=t.dataX,t.arrayY=t.dataY)}_dom_click(e,t){this._supplement_mouse_or_touch_positions(e,t),this._send_dom_event(t)}_set_xy(e,t){this._supplement_mouse_or_touch_positions(e,t);let s=this.get("xy_coordinate_system"),i=[t[s+"X"],t[s+"Y"]];void 0!==i[0]?(this.set("xy",i),this.save_changes()):console.error("No coordinates of this type found: "+s)}_send_dom_event(e){let t={target:{}},s=[];switch(this.key_mouse_or_touch(e.type)){case"touch":s=l.concat(p);break;case"mouse":s=l.concat(u),s=s.concat(d),s=s.concat(c),"wheel"==e.type?s=s.concat(h):("drop"==e.type||e.type.startsWith("drag"))&&(s=s.concat(m));break;case"keyboard":s=l.concat(f);break;default:console.error("Not familiar with that message source")}for(let i of s)p.includes(i)?t[i]=this._populate_touch_event_list(e[i]):t[i]=e[i];for(let s of g)t.target[s]=e.target[s];t.event=e.type,this.send(t,{})}_populate_touch_event_list(e){let t={},s=[],i=v.concat(d);i=i.concat(c);for(let o of e){for(let e of i)t[e]=o[e];s=s.concat(t)}return s}_prevent_event_propagation(e,t){("wheel"==t.type||this.get("prevent_default_action"))&&(t.preventDefault(),t.stopPropagation())}_throttle_or_debounce(e){let t=this.get("wait"),s=this.get("throttle_or_debounce");return t>0?"debounce"==s?_.debounce(e,t):_.throttle(e,t):e}}t.EventModel=b,b.serializers=Object.assign(Object.assign({},r.WidgetModel.serializers),{source:{deserialize:r.unpack_models}})},568:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||i(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(657),t),o(s(235),t)},480:(e,t,s)=>{var i=s(568),o=s(829);e.exports={id:"ipyevents",requires:[o.IJupyterWidgetRegistry],activate:function(e,t){t.registerWidget({name:"ipyevents",version:i.EXTENSION_SPEC_VERSION,exports:i})},autoStart:!0}},657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXTENSION_SPEC_VERSION=void 0,t.EXTENSION_SPEC_VERSION="2.0.2"}}]);